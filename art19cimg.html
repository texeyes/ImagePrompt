<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prompt Builder (Advanced)</title>
  <style>
    :root{
      --bg:#0b0f17; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --stroke:#22304a; --accent:#60a5fa; --good:#34d399;
      --field:#0f172a; --chip:#0b1222;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:24px;
      background:linear-gradient(180deg,#070a10, var(--bg));
      color:var(--text); font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
    }
    .wrap{max-width:1200px; margin:0 auto; display:grid; gap:16px; grid-template-columns: 420px 1fr;}
    @media (max-width: 980px){ .wrap{grid-template-columns: 1fr;} }
    header{max-width:1200px; margin:0 auto 16px auto;}
    h1{margin:0 0 6px 0; font-size:20px; letter-spacing:.2px}
    .sub{margin:0; color:var(--muted); font-size:13px; line-height:1.35}
    .card{
      background:rgba(17,24,39,.92);
      border:1px solid var(--stroke);
      border-radius:14px;
      box-shadow:0 14px 40px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 12px 14px;
      border-bottom:1px solid var(--stroke);
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .hd h2{margin:0; font-size:14px; font-weight:650; letter-spacing:.2px}
    /* Updated Actions bar for more buttons */
    .actions{display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; align-items:center}
    
    button{
      appearance:none; border:1px solid var(--stroke);
      background:var(--field); color:var(--text);
      padding:8px 10px; border-radius:10px;
      font-size:12px; cursor:pointer;
    }
    button:hover{border-color:#2f4369}
    button.primary{border-color:rgba(96,165,250,.55); background:rgba(96,165,250,.12)}
    button.good{border-color:rgba(52,211,153,.55); background:rgba(52,211,153,.12)}
    
    .bd{padding:14px}
    .grid{display:grid; gap:12px}
    .field label{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      font-size:12px; color:var(--muted); margin-bottom:6px;
    }
    .req{color:#fca5a5; font-size:11px}
    select, textarea, input[type="text"], input[type="number"]{
      width:100%;
      background:var(--field);
      color:var(--text);
      border:1px solid var(--stroke);
      border-radius:10px;
      padding:10px 10px;
      font-size:13px;
      outline:none;
    }
    select:focus, textarea:focus, input[type="text"]:focus{border-color:rgba(96,165,250,.75); box-shadow:0 0 0 3px rgba(96,165,250,.12)}
    textarea{min-height:120px; resize:vertical; line-height:1.35}
    .help{margin-top:6px; color:var(--muted); font-size:12px; line-height:1.35}
    .chips{display:flex; flex-wrap:wrap; gap:6px; margin-top:10px}
    .chip{
      background:var(--chip);
      border:1px solid var(--stroke);
      border-radius:999px;
      padding:6px 9px;
      font-size:11px;
      color:var(--muted);
    }
    .chip b{color:var(--text); font-weight:650}
    .split{
      display:grid; grid-template-columns: 1fr 1fr; gap:12px;
    }
    @media (max-width: 520px){ .split{grid-template-columns: 1fr;} }
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .note{color:var(--muted); font-size:12px; margin-top:10px; line-height:1.35}
    .small{font-size:11px; color:var(--muted)}
    .toast{
      position:fixed; right:18px; bottom:18px;
      background:#0b1222; border:1px solid #22304a; color:var(--text);
      padding:10px 12px; border-radius:12px; font-size:12px;
      opacity:0; transform:translateY(8px); pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      max-width:360px;
    }
    .toast.show{opacity:1; transform:translateY(0)}
    
    /* Control grouping styles */
    .rnd-group {
      display:inline-flex; gap:4px; align-items:center; 
      background:var(--field); border:1px solid var(--stroke); 
      border-radius:10px; padding:2px 4px 2px 8px;
    }
    .rnd-group input { 
      border:none; background:transparent; width:30px; padding:0; height:auto; text-align:center; color:var(--accent);
    }
    .rnd-group button {
      border:none; background:transparent; padding:4px 8px; color:var(--text); font-size:11px; border-radius:6px;
    }
    .rnd-group button:hover { background:rgba(255,255,255,0.05); }
  </style>
</head>

<body>
  <header>
    <h1>Prompt Builder</h1>
    <p class="sub">
      Pick one option per category, then copy the generated prompt (spec + condensed prompt).
    </p>
  </header>

  <div class="wrap">
    <section class="card" id="builderCard">
      <div class="hd">
        <h2>Filters</h2>
        <div class="actions">
          <!-- 1) Standard Randomize (Filters by Checkbox) -->
          <button id="randomizeBtn" class="primary" title="Randomize only checked categories">Randomize Checked</button>
          
          <!-- 2) Random (N) Button -->
          <div class="rnd-group">
             <input type="number" id="rndCountInput" value="3" min="1" max="20">
             <button id="rndCountBtn" title="Pick exactly N random categories">Rand(N)</button>
          </div>

          <!-- 3) Random (4-7) Button -->
          <button id="rndRangeBtn" class="good" title="Pick 4 to 7 random categories">Rand(4-7)</button>

          <div style="width:1px; height:20px; background:var(--stroke); margin:0 2px;"></div>

          <button id="resetBtn" title="Clear selections">Reset</button>
          <!-- Removed individual copy buttons to save space, keeping Copy All below -->
        </div>
      </div>
      <div class="bd">
        <div class="grid" id="form"></div>

        <div class="field" style="margin-top:14px">
          <label>
            Extra notes (optional)
            <span class="small">Appends to both outputs</span>
          </label>
          <textarea id="extraNotes" placeholder="Add any extra constraints: camera, lens, negatives, composition, aspect ratio, etc."></textarea>
          <div class="help">Tip: use this for one-off tweaks without changing the structured selections.</div>
        </div>

        <div class="chips" id="chips"></div>
      </div>
    </section>

    <section class="card">
      <div class="hd">
        <h2>Generated Output</h2>
        <div class="actions">
          <button id="copyPromptBtn">Copy Prompt</button>
          <button id="copyAllBtn" class="good" title="Copy spec + prompt">Copy All</button>
        </div>
      </div>
      <div class="bd">
        <div class="split">
          <div class="field">
            <label>Spec (human-readable)</label>
            <textarea id="specOut" class="mono" readonly></textarea>
          </div>
          <div class="field">
            <label>Condensed prompt</label>
            <textarea id="promptOut" class="mono" readonly></textarea>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">Copied.</div>

<script>
/**
 * CONFIGURATION
 * PASTE YOUR FULL OPTIONS LIST BACK INTO THE CATEGORIES BELOW
 */
const CONFIG = {
  version: "1.1",
  generator_name: "Prompt Builder",
  categories: [
    {
      key: "archetype",
      label: "Archetype",
      description: "High-level character/concept archetype.",
      required: true,
      multi: false,
      options: [
        { value:"an artist", label:"Artist", description:"an artist who extremely into their art and top in the world." },
        { value:"vaca influencer", label:"Vacation Lifestyle Influencer", description:"Vacation Lifestyle Influencer." },
        // ... PASTE THE REST OF YOUR 'ARCHETYPE' OPTIONS HERE ...
        { value:"quirky_alien_character", label:"Quirky alien character", description:"A practical effects monster performer in a cosplay showcase." }
      ]
    },
    {
      key: "species",
      label: "Species / Being Type",
      description: "What the subject literally is.",
      required: true,
      multi: false,
      options: [
        { value:"human_machine_hybrid_male", label:"Human-machine hybrid", description:"A cybernetic male figure integrated with clockwork." },
         // ... PASTE THE REST OF YOUR 'SPECIES' OPTIONS HERE ...
        { value:"Sentient_Dessert_Creatures", label:"Sentient Dessert Creatures", description:"Sentient Dessert Creatures" }
      ]
    },
    {
      key: "genre",
      label: "Genre / World",
      description: "Narrative + worldbuilding frame.",
      required: true,
      multi: false,
      options: [
        { value:"Corporate_Mysticism", label:"Corporate Mysticism", description:"Corporate Mysticism: Late-Stage Capitalism Meets Magic." },
         // ... PASTE THE REST OF YOUR 'GENRE' OPTIONS HERE ...
        { value:"Bureaucratic_Fantasy", label:"Bureaucratic Fantasy", description:"Bureaucratic Fantasy" }
      ]
    },
    {
      key: "medium",
      label: "Art Medium / Rendering Mode",
      description: "How it’s rendered: photo, 3D, illustration, etc.",
      required: true,
      multi: false,
      options: [
        { value:"3d_relief_physical", label:"High-detail 3D relief", description:"Photorealistic material physics; sculptural relief." },
         // ... PASTE THE REST OF YOUR 'MEDIUM' OPTIONS HERE ...
        { value:"vertical_practical_fx_video", label:"Vertical practical FX video", description:"Practical makeup/prosthetics; no digital VFX." }
      ]
    },
    {
      key: "head",
      label: "Face / Head Motif",
      description: "Primary head/face silhouette and defining motif.",
      required: true,
      multi: false,
      options: [
        { value:"Alien_dollface", label:"Alien dollface", description:"Glossy wet skin, high-contrast contour." },
         // ... PASTE THE REST OF YOUR 'HEAD' OPTIONS HERE ...
        { value:"alien_mask_grotesque", label:"Grotesque alien mask", description:"Massive black eyes; turquoise skin; crooked yellow teeth." }
      ]
    },
    {
      key: "outfit",
      label: "Outfit (Wardrobe Set)",
      description: "Wardrobe / costume description.",
      required: true,
      multi: false,
      options: [
        { value:"ceremonial_gear_armor", label:"Ceremonial body-armor", description:"Weathered teal-patina mandarin collar." },
         // ... PASTE THE REST OF YOUR 'OUTFIT' OPTIONS HERE ...
        { value:"clown_collar", label:"Bubblegum-pink collar", description:"Over textured multicolored garment." }
      ]
    },
    {
      key: "materials",
      label: "Materials & Textures",
      description: "Surface/material language to emphasize.",
      required: true,
      multi: false,
      options: [
        { value:"verdigris_metal", label:"Aged copper/brass verdigris", description:"Engraved metal with Art Nouveau flowing lines." },
         // ... PASTE THE REST OF YOUR 'MATERIALS' OPTIONS HERE ...
        { value:"prosthetics_silicone_latex", label:"Silicone/latex prosthetics", description:"Wet organic prosthetics vs dry fabric." }
      ]
    },
    {
      key: "pose",
      label: "Action / Pose",
      description: "Body language and action.",
      required: true,
      multi: false,
      options: [
        { value:"hieratic_frontal", label:"Hieratic frontal", description:"Static statue-like authority; arms rigid at sides." },
         // ... PASTE THE REST OF YOUR 'POSE' OPTIONS HERE ...
        { value:"op_art_confrontation", label:"Frontal confrontation", description:"Direct gaze."}
      ]
    }
  ]
};

// ---- App State ----
const state = {
  selections: {}, // map of category_key -> selected_value
  extraNotes: ""
};

// ---- DOM Elements ----
const $form = document.getElementById("form");
const $chips = document.getElementById("chips");
const $specOut = document.getElementById("specOut");
const $promptOut = document.getElementById("promptOut");
const $extraNotes = document.getElementById("extraNotes");
const $toast = document.getElementById("toast");

// ---- Helpers ----
const el = (tag, props={}, children=[]) => {
  const n = document.createElement(tag);
  for(let k in props) n.setAttribute(k, props[k]);
  children.forEach(c => n.appendChild(c));
  return n;
};

const randomPick = (arr) => arr[Math.floor(Math.random() * arr.length)];

// ---- Core Logic ----

// 1. Build the dynamic form with Checkboxes
function buildForm() {
  $form.innerHTML = "";

  for (const cat of CONFIG.categories) {
    const id = `sel_${cat.key}`;

    // CHECKBOX: "Include" toggle
    const $chk = el("input", { type:"checkbox", class:"rnd-include", "data-key":cat.key });
    $chk.checked = true; // Default to included

    const $chkLabel = el("label", { style:"display:flex; align-items:center; gap:4px; cursor:pointer; color:var(--accent); font-size:11px; margin:0;" }, [
        $chk,
        document.createTextNode("Include")
    ]);

    // Label Row
    const $labelRow = el("div", { style:"display:flex; justify-content:space-between; align-items:center; margin-bottom:6px" }, [
      el("span", { style:"font-size:12px; color:var(--muted); font-weight:600" }, [ document.createTextNode(cat.label) ]),
      $chkLabel
    ]);

    // Select Dropdown
    const $select = el("select", { id }, []);
    $select.appendChild(el("option", { value:"" }, [document.createTextNode(`Select ${cat.label}…`)]));
    for (const opt of cat.options) {
      const o = el("option", { value: opt.value }, [document.createTextNode(opt.label)]);
      $select.appendChild(o);
    }

    // Change listener
    $select.addEventListener("change", () => {
      state.selections[cat.key] = $select.value;
      renderAll();
    });

    const $help = el("div", { class:"help", id:`help_${cat.key}` }, [document.createTextNode(cat.description || "")]);

    const $field = el("div", { class:"field" }, [ $labelRow, $select, $help ]);
    $form.appendChild($field);
  }

  // Initial populate (if something is already in state, though typically empty on load)
  for (const cat of CONFIG.categories) {
    const sel = document.getElementById(`sel_${cat.key}`);
    if (sel && state.selections[cat.key]) sel.value = state.selections[cat.key];
  }
}

// 2. Render Outputs (Spec + Prompt)
function renderAll() {
  const specLines = [];
  const promptParts = [];
  const activeChips = [];

  for (const cat of CONFIG.categories) {
    const val = state.selections[cat.key];
    if (val) {
      const opt = cat.options.find(o => o.value === val);
      if (opt) {
        // Spec format
        specLines.push(`${cat.label}: ${opt.label}`);
        specLines.push(`  → ${opt.description}`);
        
        // Prompt format: usually just description or value. 
        // Using description provides more flavor for image gen.
        promptParts.push(opt.description);
        
        // Chips
        activeChips.push({ label: cat.label, val: opt.label });
      }
    }
  }

  if (state.extraNotes.trim()) {
    specLines.push(`\nNotes: ${state.extraNotes}`);
    promptParts.push(state.extraNotes);
  }

  $specOut.value = specLines.join("\n");
  $promptOut.value = promptParts.join(", ");

  // Render chips
  $chips.innerHTML = "";
  activeChips.forEach(c => {
    const ch = el("div", { class:"chip" }, [
      document.createTextNode(`${c.label}: `),
      el("b", {}, [document.createTextNode(c.val)])
    ]);
    $chips.appendChild(ch);
  });
}

// 3. New Randomization Logic for "Random (N)"
function randomizeSubset(count) {
  // Reset all
  state.selections = {};
  
  // Create a pool of all categories
  const allCats = [...CONFIG.categories];
  
  // Shuffle the pool (Fisher-Yates)
  for (let i = allCats.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [allCats[i], allCats[j]] = [allCats[j], allCats[i]];
  }

  // Pick top N
  const targetCats = allCats.slice(0, count);

  // Assign random values to those N, clear others
  for (const cat of CONFIG.categories) {
    // Is this category in our target list?
    if (targetCats.includes(cat)) {
       const opt = randomPick(cat.options);
       state.selections[cat.key] = opt.value;
    } else {
       state.selections[cat.key] = "";
    }
    
    // Update the dropdown UI
    const sel = document.getElementById(`sel_${cat.key}`);
    if (sel) sel.value = state.selections[cat.key];
  }

  renderAll();
  showToast(`Randomized ${count} categories.`);
}

// ---- Event Listeners ----

// RESET
document.getElementById("resetBtn").addEventListener("click", () => {
  state.selections = {};
  state.extraNotes = "";
  $extraNotes.value = "";
  // Reset checkboxes to checked
  document.querySelectorAll(".rnd-include").forEach(c => c.checked = true);
  
  // Clear dropdowns
  for (const cat of CONFIG.categories) {
    const sel = document.getElementById(`sel_${cat.key}`);
    if(sel) sel.value = "";
  }
  
  renderAll();
  showToast("Reset.");
});

// RANDOMIZE (Standard - respects checkboxes)
document.getElementById("randomizeBtn").addEventListener("click", () => {
  for (const cat of CONFIG.categories) {
    const chk = document.querySelector(`.rnd-include[data-key="${cat.key}"]`);
    
    // Only pick if checkbox exists and is checked
    if (chk && chk.checked) {
      const opt = randomPick(cat.options);
      state.selections[cat.key] = opt?.value || "";
    } else {
      // If unchecked, deselect it
      state.selections[cat.key] = "";
    }

    const sel = document.getElementById(`sel_${cat.key}`);
    if (sel) sel.value = state.selections[cat.key];
  }
  renderAll();
  showToast("Randomized (Checked Only).");
});

// RANDOM (N)
document.getElementById("rndCountBtn").addEventListener("click", () => {
  const val = parseInt(document.getElementById("rndCountInput").value) || 3;
  randomizeSubset(val);
});

// RANDOM (4-7)
document.getElementById("rndRangeBtn").addEventListener("click", () => {
  const min = 4;
  const max = 7;
  // random integer between min and max (inclusive)
  const count = Math.floor(Math.random() * (max - min + 1)) + min;
  randomizeSubset(count);
});

// Copy Buttons
document.getElementById("copyPromptBtn").addEventListener("click", () => {
  copyText($promptOut.value);
});

document.getElementById("copyAllBtn").addEventListener("click", () => {
  copyText($specOut.value + "\n\n---\n\n" + $promptOut.value);
});

// Notes Listener
$extraNotes.addEventListener("input", () => {
  state.extraNotes = $extraNotes.value;
  renderAll();
});

// Toast Helper
function showToast(msg) {
  $toast.textContent = msg;
  $toast.classList.add("show");
  setTimeout(() => $toast.classList.remove("show"), 2000);
}

// Copy Helper
function copyText(txt) {
  if (!txt) return;
  navigator.clipboard.writeText(txt).then(() => showToast("Copied to clipboard!"));
}

// ---- Init ----
buildForm();
renderAll();

</script>
</body>
</html>
