<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Art Prompt Generator - Fully Rewritten</title>
<style>
 body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
 h2 { margin-top: 30px; }
 .section { background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
 .row { display: flex; align-items: center; justify-content: space-between; }
 textarea { width: 100%; height: 90px; margin-top: 10px; }
 button { margin-top: 10px; padding: 10px 15px; border-radius: 6px; border: none; cursor: pointer; }
 #composeBtn { background: #4a72ff; color: white; }
 #randomBtn { background: #2ecc71; color: white; }
 #copyPrompt { background: #333; color: white; }
 #copyJSON { background: #555; color: white; }
 #finalOutput { white-space: pre-wrap; background: #fff; padding: 15px; border-radius: 8px; }
</style>
</head>
<body>
<h1>Art Prompt Generator (Rewritten)</h1>

<div id="sections"></div>

<button id="composeBtn">Compose Prompt</button>
<button id="randomBtn">Randomize</button>

<h2>Final Prompt</h2>
<div id="finalOutput">(Nothing yet)</div>
<button id="copyPrompt">Copy Prompt</button>
<button id="copyJSON">Copy JSON</button>

<script>
// ----------------------------
// CONFIG: Sections + Remote Sources
// ----------------------------
const sections = [
  { key: "character", label: "Character Attributes", remote: "https://texeyes.github.io/ImagePrompt/art6.html" },
  { key: "scene", label: "Scene Elements", remote: "https://texeyes.github.io/ImagePrompt/art2.html" },
  { key: "background", label: "Background Elements", remote: "https://texeyes.github.io/ImagePrompt/art3.html" },
  { key: "style", label: "Art Style", remote: "https://texeyes.github.io/ImagePrompt/art4.html" }
];

const container = document.getElementById("sections");

// Build UI
sections.forEach(sec => {
  const div = document.createElement("div");
  div.className = "section";
  div.innerHTML = `
    <div class="row">
      <h2>${sec.label}</h2>
      <label><input type="checkbox" class="toggle" data-key="${sec.key}" checked> Enabled</label>
    </div>
    <textarea class="field" data-key="${sec.key}"></textarea>
  `;
  container.appendChild(div);
});

// Utility
function getEnabledParts() {
  const parts = {};
  document.querySelectorAll('.field').forEach(el => {
    const key = el.dataset.key;
    const enabled = document.querySelector(`.toggle[data-key="${key}"]`).checked;
    if (enabled && el.value.trim()) parts[key] = el.value.trim();
  });
  return parts;
}

// Compose
function compose() {
  const parts = getEnabledParts();
  const prompt = Object.values(parts).join(', ');
  document.getElementById('finalOutput').textContent = prompt || "(No enabled sections contain text)";
  return parts;
}

document.getElementById('composeBtn').onclick = compose;

// Randomization Logic: Pull from linked sites
async function fetchRandomFrom(url) {
  try {
    const res = await fetch(url);
    const text = await res.text();
    const items = text.split(/[,\n]/).map(x => x.trim()).filter(x => x.length > 3);
    if (!items.length) return "";
    return items[Math.floor(Math.random() * items.length)];
  } catch (e) {
    return "";
  }
}

async function randomize() {
  for (const sec of sections) {
    const toggle = document.querySelector(`.toggle[data-key="${sec.key}"]`);

    // Random chance the section is turned OFF
    toggle.checked = Math.random() > 0.25;

    const field = document.querySelector(`.field[data-key="${sec.key}"]`);
    if (toggle.checked) {
      field.value = await fetchRandomFrom(sec.remote);
    } else {
      field.value = "";
    }
  }
  compose();
}

document.getElementById('randomBtn').onclick = randomize;

// Copy buttons
function toJSONOutput() {
  return JSON.stringify(getEnabledParts(), null, 2);
}

document.getElementById('copyPrompt').onclick = () => {
  const text = document.getElementById('finalOutput').textContent;
  navigator.clipboard.writeText(text);
};

document.getElementById('copyJSON').onclick = () => {
  navigator.clipboard.writeText(toJSONOutput());
};
</script>

</body>
</html>
