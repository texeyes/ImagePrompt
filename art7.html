<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Prompt Composer — Upgraded</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#7c3aed;--muted:#9aa4b2;--glass:rgba(255,255,255,0.04)}
    html,body{height:100%;margin:0;font-family:Inter,system-ui;background:#0c1120;color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    h1{margin:0 0 8px 0;font-size:22px}
    p.lead{color:var(--muted);margin-bottom:20px}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 4px 20px rgba(0,0,0,0.4)}
    label{font-size:13px;color:var(--muted)}
    textarea{width:100%;min-height:110px;background:var(--glass);border:1px solid rgba(255,255,255,0.08);color:#e6eef8;border-radius:8px;padding:10px;resize:vertical;margin-top:6px}
    button{background:linear-gradient(180deg,var(--accent),#4c1d95);border:0;padding:8px 12px;border-radius:8px;color:white;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.12)}
    .preview{padding:12px;min-height:200px;background:rgba(255,255,255,0.03);border-radius:10px;overflow:auto}
    .section{margin-top:14px}
    .small{color:var(--muted);font-size:12px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Image Prompt Composer</h1>
    <p class="lead">Now with filter toggles, random generator (including random filter disabling), and enhanced JSON copying.</p>

    <div class="grid">
      <div class="card">

        <!-- Character -->
        <div class="section">
          <label><input type="checkbox" id="useCharacter" checked> Character — <a target="_blank" href="https://texeyes.github.io/ImagePrompt/art6.html">art6</a></label>
          <textarea id="character" placeholder="Paste character..."></textarea>
        </div>

        <!-- Scene -->
        <div class="section">
          <label><input type="checkbox" id="useScene" checked> Scene — <a target="_blank" href="https://texeyes.github.io/ImagePrompt/art1.html">art1</a></label>
          <textarea id="scene" placeholder="Paste scene..."></textarea>
        </div>

        <!-- Background -->
        <div class="section">
          <label><input type="checkbox" id="useBackground" checked> Background — <a target="_blank" href="https://texeyes.github.io/ImagePrompt/art3.html">art3</a></label>
          <textarea id="background" placeholder="Paste background..."></textarea>
        </div>

        <!-- Art Style -->
        <div class="section">
          <label><input type="checkbox" id="useArtstyle" checked> Art Form (optional) — <a target="_blank" href="https://texeyes.github.io/ImagePrompt/art4.html">art4</a></label>
          <textarea id="artstyle" placeholder="Paste art style..."></textarea>
        </div>

        <div class="section" style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="composeBtn">Compose</button>
          <button id="clearBtn" class="ghost">Clear</button>
          <button id="sampleBtn" class="ghost">Sample</button>
          <button id="randomBtn" class="ghost">Randomize</button>
        </div>

      </div>

      <div class="card">
        <label class="small">Final Prompt</label>
        <div id="finalPreview" class="preview"></div>

        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="copyBtn">Copy Prompt</button>
          <button id="copyJsonBtn" class="ghost">Copy JSON</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const fields = {
    character: document.getElementById('character'),
    scene: document.getElementById('scene'),
    background: document.getElementById('background'),
    artstyle: document.getElementById('artstyle')
  }

  const toggles = {
    character: document.getElementById('useCharacter'),
    scene: document.getElementById('useScene'),
    background: document.getElementById('useBackground'),
    artstyle: document.getElementById('useArtstyle')
  }

  const finalPreview = document.getElementById('finalPreview')

  function compose(){
    const parts = []
    for(const key of Object.keys(fields)){
      if(toggles[key].checked && fields[key].value.trim()){
        parts.push(fields[key].value.trim())
      }
    }
    const prompt = parts.join(', ').replace(/,{2,}/g,',')
    finalPreview.textContent = prompt
    return prompt
  }

  document.getElementById('composeBtn').onclick = compose

  document.getElementById('clearBtn').onclick = () => {
    for(const f of Object.values(fields)) f.value = ''
    for(const t of Object.values(toggles)) t.checked = true
    compose()
  }

  document.getElementById('sampleBtn').onclick = () => {
    fields.character.value = 'A charismatic humanoid mascot'
    fields.scene.value = 'floating midair among drifting petals'
    fields.background.value = 'abandoned moonlit warehouse'
    fields.artstyle.value = 'halftone engraving, monochromatic drama'
    compose()
  }

  // Random generator with random disabling
  document.getElementById('randomBtn').onclick = () => {
    const grab = arr => arr[Math.floor(Math.random()*arr.length)]

    const sampleData = {
      character: [
        'physiology: humanoid-dominant hybrid; body-type: compact mascot; age: timeless; mood: inviting confidence; features: expressive eyes, sculpted silhouette',
        'physiology: soft-organic construct; body-type: plush-round; age: youthful; mood: playful serenity; features: oversized head ratio, symbolic markings',
        'physiology: ancient ceremonial entity; body-type: lean-elegant; age: ageless; mood: stoic presence; features: carved patterns, metallic filigree',
        'physiology: mechanical-organic fusion; body-type: sturdy-medium; age: veteran; mood: focused determination; features: layered plating, glowing accents',
        'physiology: mythical humanoid; body-type: elongated-balanced; age: ethereal; mood: curious wonder; features: subtle bioluminescence, soft contours'
      ],
      scene: [
        'charging across cracked concrete',
        'hovering through shattered glass',
        'emerging from drifting fog',
        'standing in dramatic spotlight'
      ],
      background: [
        'dystopian skyline at night',
        'sunken cathedral ruins',
        'abandoned factory corridor',
        'neon alleyway with steam vents'
      ],
      artstyle: [
        'oil-painted surrealism',
        'engraved halftone print',
        'hyper-realistic chiaroscuro',
        'bold graphic novel style'
      ]
    }

    // some random chance to turn off a filter completely
    for(const key of Object.keys(toggles)): [
        'oil-painted surrealism',
        'engraved halftone print',
        'hyper-realistic chiaroscuro',
        'bold graphic novel style'
      ]
    }

    // some random chance to turn off a filter completely
    for(const key of Object.keys(toggles)){
      toggles[key].checked = Math.random() > 0.25
    }

    for(const key of Object.keys(fields)){
      if(toggles[key].checked){
        fields[key].value = grab(sampleData[key])
      } else {
        fields[key].value = ''
      }
    }
    compose()
  }

  document.getElementById('copyBtn').onclick = async () => {
    const text = compose()
    try{ await navigator.clipboard.writeText(text); alert('Copied!') }
    catch{ alert('Copy failed.') }
  }

  document.getElementById('copyJsonBtn').onclick = async () => {
    const json = JSON.stringify({
      used: {
        character: toggles.character.checked,
        scene: toggles.scene.checked,
        background: toggles.background.checked,
        artstyle: toggles.artstyle.checked
      },
      inputs: {
        character: fields.character.value,
        scene: fields.scene.value,
        background: fields.background.value,
        artstyle: fields.artstyle.value
      },
      prompt: compose()
    }, null, 2)

    try{ await navigator.clipboard.writeText(json); alert('JSON copied!') }
    catch{ alert('Unable to copy JSON.') }
  }

  compose()
</script>
</body>
</html>
